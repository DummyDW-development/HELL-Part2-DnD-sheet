<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AD&D 2nd Edition Character Sheet (Custom)</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Times New Roman', serif;
        }

        body {
            background-color: #f5e8c8;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .character-sheet {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            border: 1px solid #8b4513;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #8b4513;
            padding-bottom: 10px;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            color: #8b4513;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header h2 {
            margin: 5px 0 0;
            font-size: 18px;
            font-style: italic;
            color: #666;
        }

        .section {
            margin-bottom: 15px;
            border: 1px solid #ccc;
            padding: 10px;
        }

        .section-title {
            background-color: #e6d2b5;
            margin: -10px -10px 10px;
            padding: 5px 10px;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
        }

        .form-group {
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        label {
            display: inline-block;
            min-width: 120px;
            font-weight: bold;
            margin-right: 5px;
        }

        input,
        select {
            padding: 3px 5px;
            border: 1px solid #999;
            border-left:none;
            border-right:none;
            background-color: #fff;
            margin-right: 15px;
            margin-bottom: 5px;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .abilities-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .ability-box {
            border: 1px solid #999;
            padding: 5px;
        }

        .ability-box label {
            display: block;
            width: 100%;
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }

        .ability-box input {
            width: 50px;
            text-align: center;
            margin: 0 auto 5px;
            display: block;
        }

        .ability-details {
            font-size: 12px;
            margin-top: 5px;
        }

        .ability-detail {
            margin-bottom: 2px;
        }

        .ability-detail label {
            min-width: 70px;
            font-size: 11px;
            font-weight: normal;
        }

        .ability-detail input {
            width: 40px;
            font-size: 11px;
            margin-right: 0;
        }

        .armor-section {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
        }

        .ac-box {
            border: 1px solid #999;
            padding: 10px;
            text-align: center;
        }

        .ac-box label {
            display: block;
            width: 100%;
            margin-bottom: 5px;
        }

        .ac-box input {
            width: 60px;
            text-align: center;
            margin: 0 auto;
        }

        .ac-adjustments {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
        }

        .ac-adjustment {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .ac-adjustment label {
            min-width: 100px;
        }

        .ac-adjustment input {
            width: 60px;
        }

        .defenses {
            margin-top: 10px;
        }

        .defenses input {
            width: 100%;
        }

        .hp-movement {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
        }

        .hp-box {
            border: 1px solid #999;
            padding: 10px;
            text-align: center;
        }

        .hp-box label {
            display: block;
            width: 100%;
            margin-bottom: 5px;
        }

        .hp-box input {
            width: 60px;
            text-align: center;
            margin: 0 auto;
        }

        .movement-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
        }

        .movement-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .movement-item label {
            min-width: 80px;
        }

        .movement-item input {
            width: 40px;
        }

        .saving-throws {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .saving-throw {
            border: 1px solid #999;
            padding: 5px;
        }

        .saving-throw label {
            display: block;
            width: 100%;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
        }

        .saving-throw-inputs {
            display: flex;
            justify-content: space-between;
        }

        .saving-throw-inputs input {
            width: 40px;
            text-align: center;
        }

        .weapons-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 12px;
        }

        .weapons-table th,
        .weapons-table td {
            border: 1px solid #999;
            padding: 5px;
            text-align: center;
        }

        .weapons-table th {
            background-color: #e6d2b5;
        }

        .weapons-table input {
            width: 100%;
            border: none;
            text-align: center;
            font-size: 12px;
            padding: 2px;
        }

        .special-attacks {
            margin-top: 15px;
        }

        .special-attacks-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
        }

        .attacks-textarea {
            width: 100%;
            height: 80px;
            padding: 5px;
            border: 1px solid #999;
            resize: vertical;
        }

        .ammo-checkboxes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .checkbox-group input {
            margin-right: 5px;
        }

        .special-abilities {
            margin-top: 15px;
        }

        .abilities-grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .ability-line {
            margin-bottom: 5px;
        }

        .ability-line input {
            width: 100%;
        }

        .proficiencies {
            margin-top: 15px;
        }

        .proficiencies-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .proficiency-line {
            margin-bottom: 5px;
        }

        .proficiency-line input {
            width: 100%;
        }

        .controls {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #8b4513;
        }

        button {
            padding: 8px 15px;
            margin: 0 5px;
            background-color: #8b4513;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #6b3300;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted #8b4513;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            line-height: 1.4;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .label-input-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 10px;
        }

        /* Optional: Make labels have a consistent min-width if desired */
        .label-input-row label {
            min-width: 150px;
            /* or any width you prefer */
            margin-right: 10px;
            font-weight: bold;
        }

        /* Ensures label-input pairs stay on the same line and aligned */
        .label-input-pair {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .label-input-pair label {
            min-width: 150px;
            /* or any fixed width for alignment */
            margin-right: 10px;
            font-weight: bold;
        }

        .char-inf {
            text-align: center;
        }

        /* Character Library Styles */
        .character-library {
            margin-top: 30px;
            border-top: 2px solid #8b4513;
            padding-top: 20px;
        }

        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .search-box {
            padding: 8px 12px;
            border: 1px solid #8b4513;
            border-radius: 4px;
            width: 250px;
            font-size: 14px;
        }

        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .character-card {
            border: 1px solid #8b4513;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f3e9;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .character-card h3 {
            margin: 0 0 10px 0;
            color: #8b4513;
            border-bottom: 1px solid #e6d2b5;
            padding-bottom: 5px;
        }

        .character-card p {
            margin: 5px 0;
            font-size: 14px;
        }

        .character-card .details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .character-card .details span {
            font-weight: bold;
        }

        .character-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .character-actions button {
            padding: 6px 12px;
            font-size: 13px;
        }

        .load-btn {
            background-color: #1EB373;
        }

        .load-btn:hover {
            background-color: #189e63;
        }

        .delete-btn {
            background-color: #e74c3c;
        }

        .delete-btn:hover {
            background-color: #c0392b;
        }

        .no-characters {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        /* Mobile Styles - Fixed syntax error */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
                padding: 10px;
            }

            .character-sheet {
                max-width: 100%;
                padding: 10px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header h2 {
                font-size: 16px;
            }

            /* Input Layouts */
            .label-input-pair,
            .label-input-row {
                flex-direction: column;
                align-items: stretch;
                margin-bottom: 12px;
            }

            label {
                min-width: 100px;
                margin-bottom: 6px;
                font-size: 14px;
            }

            input[type="text"],
            input[type="number"],
            textarea {
                width: 100%;
                font-size: 14px;
                padding: 6px;
            }

            /* Grid Adjustments */
            .abilities-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .abilities-grid-2col,
            .proficiencies-grid,
            .two-column,
            .three-column {
                grid-template-columns: 1fr;
            }

            /* Armor & Movement */
            .armor-section,
            .hp-movement {
                display: block;
            }

            .ac-box,
            .hp-box {
                margin-bottom: 15px;
            }

            /* Weapons Table */
            .weapons-table {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* Controls */
            .controls {
                flex-direction: column;
            }

            .controls button {
                width: 100%;
                margin: 6px 0;
                padding: 10px;
                font-size: 16px;
            }

            /* Tooltips */
            .tooltip .tooltiptext {
                width: 90vw;
                left: 50%;
                margin-left: -45vw;
                padding: 8px;
                font-size: 12px;
            }

            /* Ammo Checkboxes */
            .ammo-checkboxes {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            /* Ability Details */
            .ability-detail input {
                width: 100%;
            }

            /* Movement Grid */
            .movement-grid {
                grid-template-columns: 1fr 1fr;
            }

            /* Saving Throws */
            .saving-throws {
                grid-template-columns: 1fr 1fr;
            }

            /* Section Headers */
            .section-title {
                font-size: 14px;
            }

            /* Character Library Mobile Styles */
            .library-header {
                flex-direction: column;
                gap: 10px;
            }

            .search-box {
                width: 100%;
            }

            .characters-grid {
                grid-template-columns: 1fr;
            }

            .character-actions {
                flex-direction: column;
                gap: 5px;
            }

            .character-actions button {
                width: 100%;
            }
        }

        /* Touch-friendly adjustments */
        @media (hover: none) {
            .tooltip:hover .tooltiptext {
                visibility: visible;
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="character-sheet">
        <div class="header">
            <h1>Advanced Dungeons & Dragons</h1>
            <h2>2nd Edition Character Record Sheet</h2>
        </div>

        <div class="section char-inf">
            <div class="section-title">Character Information</div>

            <!-- PRIMARY IDENTITY -->
            <div class="two-column">
                <div class="label-input-pair">
                    <label for="players-name" class="tooltip">Player's Name:
                        <span class="tooltiptext">The real-world player's name</span>
                    </label>
                    <input type="text" id="players-name" placeholder="Player's name">
                </div>

                <div class="label-input-pair">
                    <label for="family" class="tooltip">Character Name:
                        <span class="tooltiptext">Character's name.</span>
                    </label>
                    <input type="text" id="family" placeholder="e.g., Aragorn, House Targaryen">
                </div>
            </div>

            <!-- CORE STATS -->
            <div class="two-column">
                <div class="label-input-pair">
                    <label for="align" class="tooltip">Alignment:
                        <span class="tooltiptext">Character's moral/ethical stance (e.g., Lawful Good)</span>
                    </label>
                    <input type="text" id="align" placeholder="e.g., Chaotic Neutral">
                </div>

                <div class="label-input-pair">
                    <label for="race" class="tooltip">Race / Clan:
                        <span class="tooltiptext">Character's species + subrace/clan (e.g., High Elf)</span>
                    </label>
                    <input type="text" id="race" placeholder="e.g., Elf, Hill Dwarf">
                </div>

                <div class="label-input-pair">
                    <label for="class" class="tooltip">Class:
                        <span class="tooltiptext">Character's profession (e.g., Fighter, Mage)</span>
                    </label>
                    <input type="text" id="class" placeholder="e.g., Rogue">
                </div>

                <div class="label-input-pair">
                    <label for="level" class="tooltip">Level:
                        <span class="tooltiptext">Experience level (starts at 1)</span>
                    </label>
                    <input type="text" id="level" class="comma-number" value="1">
                </div>
            </div>

            <!-- PHYSICAL TRAITS -->
            <div class="two-column">
                <div class="label-input-pair">
                    <label for="sex" class="tooltip">Sex:
                        <span class="tooltiptext">Character's gender</span>
                    </label>
                    <input type="text" id="sex" placeholder="e.g., Male, Female, Other">
                </div>

                <div class="label-input-pair">
                    <label for="age" class="tooltip">Age:
                        <span class="tooltiptext">Character's age in years</span>
                    </label>
                    <input type="text" id="age" class="comma-number" value="20">
                </div>

                <div class="label-input-pair">
                    <label for="ht" class="tooltip">Height:
                        <span class="tooltiptext">In feet/inches (e.g., 5'10")</span>
                    </label>
                    <input type="text" id="ht" placeholder="e.g., 6'2&quot;">
                </div>

                <div class="label-input-pair">
                    <label for="wt" class="tooltip">Weight:
                        <span class="tooltiptext">In pounds</span>
                    </label>
                    <input type="text" id="wt" placeholder="e.g., 180 lbs">
                </div>

                <div class="label-input-pair">
                    <label for="hair" class="tooltip">Hair:
                        <span class="tooltiptext">Color and style</span>
                    </label>
                    <input type="text" id="hair" placeholder="e.g., Black, Braided">
                </div>

                <div class="label-input-pair">
                    <label for="eyes" class="tooltip">Eyes:
                        <span class="tooltiptext">Eye color</span>
                    </label>
                    <input type="text" id="eyes" placeholder="e.g., Blue, Glowing Red">
                </div>
            </div>

            <!-- BACKGROUND -->
            <div class="two-column">
                <div class="label-input-pair">
                    <label for="homland" class="tooltip">Homeland:
                        <span class="tooltiptext">Place of origin</span>
                    </label>
                    <input type="text" id="homland" placeholder="e.g., Rivendell">
                </div>

                <div class="label-input-pair">
                    <label for="social-class" class="tooltip">Social Class:
                        <span class="tooltiptext">Peasant, Noble, Merchant, etc.</span>
                    </label>
                    <input type="text" id="social-class" placeholder="e.g., Noble">
                </div>

                <div class="label-input-pair">
                    <label for="religion" class="tooltip">Religion:
                        <span class="tooltiptext">Deity or religious affiliation</span>
                    </label>
                    <input type="text" id="religion" placeholder="e.g., Church of Lathander">
                </div>

                <div class="label-input-pair">
                    <label for="leige-patron" class="tooltip">Leige/Patron:
                        <span class="tooltiptext">Feudal lord, patron, or employer</span>
                    </label>
                    <input type="text" id="leige-patron" placeholder="e.g., King of Gondor">
                </div>
            </div>

            <!-- SOCIAL/REPUTATION -->
            <div class="two-column">
                <div class="label-input-pair">
                    <label for="status" class="tooltip">Status/Title:
                        <span class="tooltiptext">Current title or status</span>
                    </label>
                    <input type="text" id="status" placeholder="e.g., Warden of the North">
                </div>

                <div class="label-input-pair">
                    <label for="honor" class="tooltip">Honor/Reputation:
                        <span class="tooltiptext">Honor score or reputation</span>
                    </label>
                    <input type="text" id="honor" class="comma-number" value="0">
                </div>

                <div class="label-input-pair">
                    <label for="base-honor" class="tooltip">Base Honor:
                        <span class="tooltiptext">Starting honor value</span>
                    </label>
                    <input type="text" id="base-honor" class="comma-number" value="0">
                </div>

                <div class="label-input-pair">
                    <label for="reaction-adjustment" class="tooltip">Reaction Adjustment:
                        <span class="tooltiptext">Charisma-based NPC interaction modifier</span>
                    </label>
                    <input type="text" id="reaction-adjustment" class="comma-number" value="0">
                </div>

                <div class="label-input-pair">
                    <label for="appearance" class="tooltip">Appearance:
                        <span class="tooltiptext">Distinguishing features or general description</span>
                    </label>
                    <input type="text" id="appearance" placeholder="e.g., Scar across left eye">
                </div>
            </div>

            <!-- FAMILY DETAILS -->
            <div class="two-column">
                <div class="label-input-pair">
                    <label for="birth-rank" class="tooltip">Birth Order:
                        <span class="tooltiptext">Position among siblings</span>
                    </label>
                    <input type="text" id="birth-rank" placeholder="e.g., 2nd of 5">
                </div>

                <div class="label-input-pair">
                    <label for="siblings" class="tooltip"># Siblings:
                        <span class="tooltiptext">Total number of siblings</span>
                    </label>
                    <input type="text" id="siblings" class="comma-number" value="0">
                </div>
            </div>
        </div>
        <div class="section">
            <div class="section-title">Abilities</div>
            <div class="abilities-grid">
                <div class="ability-box">
                    <label for="str" class="tooltip">STR
                        <span class="tooltiptext">Strength - Measures physical power, affecting melee combat and carrying capacity</span>
                    </label>
                    <input type="text" id="str" class="comma-number" value="10">
                    <div class="ability-details">
                        <div class="ability-detail">
                            <label for="str-hit-prob" class="tooltip">Hit Prob:
                                <span class="tooltiptext">To-hit probability modifier in melee combat</span>
                            </label>
                            <input type="text" id="str-hit-prob" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="str-dmg-adj" class="tooltip">Dmg Adj:
                                <span class="tooltiptext">Damage adjustment for melee attacks</span>
                            </label>
                            <input type="text" id="str-dmg-adj" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="str-max-press" class="tooltip">Max Press:
                                <span class="tooltiptext">Maximum weight the character can press overhead</span>
                            </label>
                            <input type="text" id="str-max-press" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="str-op-drs" class="tooltip">Op Drs:
                                <span class="tooltiptext">Chance to open doors (as percentage)</span>
                            </label>
                            <input type="text" id="str-op-drs" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="str-bb-lg" class="tooltip">BB/LG:
                                <span class="tooltiptext">Bend bars/lift gates percentage chance</span>
                            </label>
                            <input type="text" id="str-bb-lg" class="comma-number" value="0">
                        </div>
                    </div>
                </div>

                <div class="ability-box">
                    <label for="dex" class="tooltip">DEX
                        <span class="tooltiptext">Dexterity - Measures agility, reflexes, and balance</span>
                    </label>
                    <input type="text" id="dex" class="comma-number" value="10">
                    <div class="ability-details">
                        <div class="ability-detail">
                            <label for="dex-rctn-adj" class="tooltip">Rctn Adj:
                                <span class="tooltiptext">Reaction adjustment for surprise and initiative</span>
                            </label>
                            <input type="text" id="dex-rctn-adj" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="dex-missile-adj" class="tooltip">Missile Adj:
                                <span class="tooltiptext">Attack adjustment for missile weapons</span>
                            </label>
                            <input type="text" id="dex-missile-adj" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="dex-def-adj" class="tooltip">Def Adj:
                                <span class="tooltiptext">Defensive adjustment to Armor Class</span>
                            </label>
                            <input type="text" id="dex-def-adj" class="comma-number" value="0">
                        </div>
                    </div>
                </div>

                <div class="ability-box">
                    <label for="con" class="tooltip">CON
                        <span class="tooltiptext">Constitution - Measures health, stamina, and resilience</span>
                    </label>
                    <input type="text" id="con" class="comma-number" value="10">
                    <div class="ability-details">
                        <div class="ability-detail">
                            <label for="con-hp-adj" class="tooltip">HP Adj:
                                <span class="tooltiptext">Hit point adjustment per level or hit die</span>
                            </label>
                            <input type="text" id="con-hp-adj" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="con-says-shk" class="tooltip">Says Shk:
                                <span class="tooltiptext">System shock survival percentage</span>
                            </label>
                            <input type="text" id="con-says-shk" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="con-res-sur" class="tooltip">Res Sur:
                                <span class="tooltiptext">Resurrection survival percentage</span>
                            </label>
                            <input type="text" id="con-res-sur" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="con-poison-save" class="tooltip">Poison Save:
                                <span class="tooltiptext">Bonus/penalty to poison saving throws</span>
                            </label>
                            <input type="text" id="con-poison-save" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="con-regen" class="tooltip">Regen:
                                <span class="tooltiptext">Regeneration rate if applicable (e.g., trolls)</span>
                            </label>
                            <input type="text" id="con-regen" class="comma-number" value="0">
                        </div>
                    </div>
                </div>

                <div class="ability-box">
                    <label for="int" class="tooltip">INT
                        <span class="tooltiptext">Intelligence - Measures reasoning, memory, and learning ability</span>
                    </label>
                    <input type="text" id="int" class="comma-number" value="10">
                    <div class="ability-details">
                        <div class="ability-detail">
                            <label for="int-lang" class="tooltip">No of Lang:
                                <span class="tooltiptext">Number of additional languages known</span>
                            </label>
                            <input type="text" id="int-lang" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="int-spell-lvl" class="tooltip">Spell Lvl:
                                <span class="tooltiptext">Highest spell level that can be cast</span>
                            </label>
                            <input type="text" id="int-spell-lvl" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="int-lrn-sp" class="tooltip">Lrn Sp:
                                <span class="tooltiptext">Chance to learn a new spell (percentage)</span>
                            </label>
                            <input type="text" id="int-lrn-sp" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="int-spells-level" class="tooltip">Spells/Level:
                                <span class="tooltiptext">Maximum spells per level for wizards</span>
                            </label>
                            <input type="text" id="int-spells-level" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="int-spell-immune" class="tooltip">Spell Immune:
                                <span class="tooltiptext">Spells the character is immune to</span>
                            </label>
                            <input type="text" id="int-spell-immune" placeholder="Spell immunities">
                        </div>
                    </div>
                </div>

                <div class="ability-box">
                    <label for="wis" class="tooltip">WIS
                        <span class="tooltiptext">Wisdom - Measures willpower, common sense, and intuition</span>
                    </label>
                    <input type="text" id="wis" class="comma-number" value="10">
                    <div class="ability-details">
                        <div class="ability-detail">
                            <label for="wis-mag-def" class="tooltip">Mag Def Adj:
                                <span class="tooltiptext">Magic defense adjustment to saving throws</span>
                            </label>
                            <input type="text" id="wis-mag-def" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="wis-bonus-spells" class="tooltip">Bonus Spells:
                                <span class="tooltiptext">Bonus spells for clerical characters</span>
                            </label>
                            <input type="text" id="wis-bonus-spells" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="wis-spell-fail" class="tooltip">Spell Fail:
                                <span class="tooltiptext">Chance of spell failure (percentage)</span>
                            </label>
                            <input type="text" id="wis-spell-fail" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="wis-spell-immune" class="tooltip">Spell Immune:
                                <span class="tooltiptext">Spells the character is immune to</span>
                            </label>
                            <input type="text" id="wis-spell-immune" placeholder="Spell immunities">
                        </div>
                    </div>
                </div>

                <div class="ability-box">
                    <label for="chr" class="tooltip">CHR
                        <span class="tooltiptext">Charisma - Measures force of personality and leadership</span>
                    </label>
                    <input type="text" id="chr" class="comma-number" value="10">
                    <div class="ability-details">
                        <div class="ability-detail">
                            <label for="chr-max-hench" class="tooltip">Max No Hench:
                                <span class="tooltiptext">Maximum number of henchmen</span>
                            </label>
                            <input type="text" id="chr-max-hench" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="chr-loy-base" class="tooltip">Loy Base:
                                <span class="tooltiptext">Loyalty base score for henchmen</span>
                            </label>
                            <input type="text" id="chr-loy-base" class="comma-number" value="0">
                        </div>
                        <div class="ability-detail">
                            <label for="chr-rctn-adj" class="tooltip">Rctn Adj:
                                <span class="tooltiptext">Reaction adjustment from NPCs</span>
                            </label>
                            <input type="text" id="chr-rctn-adj" class="comma-number" value="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Armor</div>
            <div class="armor-section">
                <div class="ac-box">
                    <label for="ac" class="tooltip">AC
                        <span class="tooltiptext">Armor Class - Lower is better. Base is 10 without armor</span>
                    </label>
                    <input type="text" id="ac" class="comma-number" value="10">
                </div>
                <div>
                    <div class="ac-adjustments">
                        <div class="ac-adjustment">
                            <label for="surprised-ac" class="tooltip">Surprised
                                <span class="tooltiptext">AC when surprised (typically worse)</span>
                            </label>
                            <input type="text" id="surprised-ac" class="comma-number" value="10">
                        </div>
                        <div class="ac-adjustment">
                            <label for="shieldless-ac" class="tooltip">Shieldless
                                <span class="tooltiptext">AC without shield (if normally using one)</span>
                            </label>
                            <input type="text" id="shieldless-ac" class="comma-number" value="10">
                        </div>
                        <div class="ac-adjustment">
                            <label for="rear-ac" class="tooltip">Rear
                                <span class="tooltiptext">AC when attacked from behind</span>
                            </label>
                            <input type="text" id="rear-ac" class="comma-number" value="10">
                        </div>
                    </div>
                    <div class="defenses">
                        <label for="armor-type" class="tooltip">Armor Type (Pieces)
                            <span class="tooltiptext">Type of armor worn and which pieces (e.g., Plate Mail, full suit)</span>
                        </label>
                        <input type="text" id="armor-type" placeholder="Armor type and pieces">

                        <label for="defenses" class="tooltip">Defenses
                            <span class="tooltiptext">Special defenses (magical items, spells, racial traits)</span>
                        </label>
                        <input type="text" id="defenses" placeholder="Special defenses">
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Hit Points</div>
            <div class="hp-movement">
                <div class="hp-box">
                    <label for="hit-points" class="tooltip">Hit Points
                        <span class="tooltiptext">Current hit points - when reduced to 0, character is unconscious</span>
                    </label>
                    <input type="text" id="hit-points" class="comma-number" value="0">

                    <label for="wounds" class="tooltip">Wounds
                        <span class="tooltiptext">Description of specific wounds or conditions</span>
                    </label>
                    <input type="text" id="wounds" placeholder="Wound description">
                </div>

                <div>
                    <div class="label-input-row">
                        <label for="base-rate" class="tooltip">Base Rate
                            <span class="tooltiptext">Base movement rate in feet per round</span>
                        </label>
                        <input type="text" id="base-rate" class="comma-number" value="12">
                    </div>

                    <div class="movement-grid">
                        <div class="movement-item">
                            <label for="light-move" class="tooltip">Light ( )
                                <span class="tooltiptext">Movement rate when lightly encumbered</span>
                            </label>
                            <input type="text" id="light-move" class="comma-number" value="12">
                        </div>
                        <div class="movement-item">
                            <label for="mod-move" class="tooltip">Mod ( )
                                <span class="tooltiptext">Movement rate when moderately encumbered</span>
                            </label>
                            <input type="text" id="mod-move" class="comma-number" value="9">
                        </div>
                        <div class="movement-item">
                            <label for="hvy-move" class="tooltip">Hvy ( )
                                <span class="tooltiptext">Movement rate when heavily encumbered</span>
                            </label>
                            <input type="text" id="hvy-move" class="comma-number" value="6">
                        </div>
                        <div class="movement-item">
                            <label for="svr-move" class="tooltip">Svr ( )
                                <span class="tooltiptext">Movement rate when severely encumbered</span>
                            </label>
                            <input type="text" id="svr-move" class="comma-number" value="3">
                        </div>
                        <div class="movement-item">
                            <label for="jog-move" class="tooltip">Jog (x2)
                                <span class="tooltiptext">Jogging movement rate (x2 base)</span>
                            </label>
                            <input type="text" id="jog-move" class="comma-number" value="24">
                        </div>
                        <div class="movement-item">
                            <label for="run3-move" class="tooltip">Run (x3)
                                <span class="tooltiptext">Running movement rate (x3 base)</span>
                            </label>
                            <input type="text" id="run3-move" class="comma-number" value="36">
                        </div>
                        <div class="movement-item">
                            <label for="run4-move" class="tooltip">Run (x4)
                                <span class="tooltiptext">Running movement rate (x4 base)</span>
                            </label>
                            <input type="text" id="run4-move" class="comma-number" value="48">
                        </div>
                        <div class="movement-item">
                            <label for="run5-move" class="tooltip">Run (x5)
                                <span class="tooltiptext">Running movement rate (x5 base) - maximum for most characters</span>
                            </label>
                            <input type="text" id="run5-move" class="comma-number" value="60">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Saving Throws</div>
            <div class="saving-throws">
                <div class="saving-throw">
                    <label for="save-paralyze" class="tooltip">Paralyze/Poison
                        <span class="tooltiptext">Save vs. paralysis, poison, or death magic</span>
                    </label>
                    <div class="saving-throw-inputs">
                        <input type="text" id="save-paralyze-mod" class="comma-number" placeholder="Mod" value="0">
                        <input type="text" id="save-paralyze" class="comma-number" placeholder="Save" value="0">
                    </div>
                </div>
                <div class="saving-throw">
                    <label for="save-rod" class="tooltip">Rod, Staff, or Wand
                        <span class="tooltiptext">Save vs. magical rods, staves, and wands</span>
                    </label>
                    <div class="saving-throw-inputs">
                        <input type="text" id="save-rod-mod" class="comma-number" placeholder="Mod" value="0">
                        <input type="text" id="save-rod" class="comma-number" placeholder="Save" value="0">
                    </div>
                </div>
                <div class="saving-throw">
                    <label for="save-petrify" class="tooltip">Petrify/Polymorph
                        <span class="tooltiptext">Save vs. petrification or polymorph effects</span>
                    </label>
                    <div class="saving-throw-inputs">
                        <input type="text" id="save-petrify-mod" class="comma-number" placeholder="Mod" value="0">
                        <input type="text" id="save-petrify" class="comma-number" placeholder="Save" value="0">
                    </div>
                </div>
                <div class="saving-throw">
                    <label for="save-breath" class="tooltip">Breath Weapon
                        <span class="tooltiptext">Save vs. breath weapons (dragons, etc.)</span>
                    </label>
                    <div class="saving-throw-inputs">
                        <input type="text" id="save-breath-mod" class="comma-number" placeholder="Mod" value="0">
                        <input type="text" id="save-breath" class="comma-number" placeholder="Save" value="0">
                    </div>
                </div>
                <div class="saving-throw">
                    <label for="save-spell" class="tooltip">Spell
                        <span class="tooltiptext">Save vs. spells (including spell-like effects)</span>
                    </label>
                    <div class="saving-throw-inputs">
                        <input type="text" id="save-spell-mod" class="comma-number" placeholder="Mod" value="0">
                        <input type="text" id="save-spell" class="comma-number" placeholder="Save" value="0">
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Weapons</div>
            <table class="weapons-table">
                <thead>
                    <tr>
                        <th>Weapon</th>
                        <th>#AT</th>
                        <th>Attack Adj/Dmg Adj</th>
                        <th>THAC0</th>
                        <th>Damage (SM/L)</th>
                        <th>Range</th>
                        <th>Weight</th>
                        <th>Size</th>
                        <th>Type</th>
                        <th>Speed</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Weapon name"></td>
                        <td><input type="text" placeholder="#AT"></td>
                        <td><input type="text" placeholder="Adj"></td>
                        <td><input type="text" placeholder="THAC0"></td>
                        <td><input type="text" placeholder="Damage"></td>
                        <td><input type="text" placeholder="Range"></td>
                        <td><input type="text" placeholder="Weight"></td>
                        <td><input type="text" placeholder="Size"></td>
                        <td><input type="text" placeholder="Type"></td>
                        <td><input type="text" placeholder="Speed"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Weapon name"></td>
                        <td><input type="text" placeholder="#AT"></td>
                        <td><input type="text" placeholder="Adj"></td>
                        <td><input type="text" placeholder="THAC0"></td>
                        <td><input type="text" placeholder="Damage"></td>
                        <td><input type="text" placeholder="Range"></td>
                        <td><input type="text" placeholder="Weight"></td>
                        <td><input type="text" placeholder="Size"></td>
                        <td><input type="text" placeholder="Type"></td>
                        <td><input type="text" placeholder="Speed"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Weapon name"></td>
                        <td><input type="text" placeholder="#AT"></td>
                        <td><input type="text" placeholder="Adj"></td>
                        <td><input type="text" placeholder="THAC0"></td>
                        <td><input type="text" placeholder="Damage"></td>
                        <td><input type="text" placeholder="Range"></td>
                        <td><input type="text" placeholder="Weight"></td>
                        <td><input type="text" placeholder="Size"></td>
                        <td><input type="text" placeholder="Type"></td>
                        <td><input type="text" placeholder="Speed"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Weapon name"></td>
                        <td><input type="text" placeholder="#AT"></td>
                        <td><input type="text" placeholder="Adj"></td>
                        <td><input type="text" placeholder="THAC0"></td>
                        <td><input type="text" placeholder="Damage"></td>
                        <td><input type="text" placeholder="Range"></td>
                        <td><input type="text" placeholder="Weight"></td>
                        <td><input type="text" placeholder="Size"></td>
                        <td><input type="text" placeholder="Type"></td>
                        <td><input type="text" placeholder="Speed"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Weapon name"></td>
                        <td><input type="text" placeholder="#AT"></td>
                        <td><input type="text" placeholder="Adj"></td>
                        <td><input type="text" placeholder="THAC0"></td>
                        <td><input type="text" placeholder="Damage"></td>
                        <td><input type="text" placeholder="Range"></td>
                        <td><input type="text" placeholder="Weight"></td>
                        <td><input type="text" placeholder="Size"></td>
                        <td><input type="text" placeholder="Type"></td>
                        <td><input type="text" placeholder="Speed"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Weapon name"></td>
                        <td><input type="text" placeholder="#AT"></td>
                        <td><input type="text" placeholder="Adj"></td>
                        <td><input type="text" placeholder="THAC0"></td>
                        <td><input type="text" placeholder="Damage"></td>
                        <td><input type="text" placeholder="Range"></td>
                        <td><input type="text" placeholder="Weight"></td>
                        <td><input type="text" placeholder="Size"></td>
                        <td><input type="text" placeholder="Type"></td>
                        <td><input type="text" placeholder="Speed"></td>
                    </tr>
                </tbody>
            </table>

            <div class="special-attacks">
                <div class="special-attacks-grid">
                    <div>
                        <label for="special-attacks" class="tooltip">Special Attacks
                            <span class="tooltiptext">Special combat abilities, maneuvers, or attacks</span>
                        </label>
                        <textarea class="attacks-textarea" id="special-attacks" placeholder="Describe special attacks"></textarea>
                    </div>
                    <div>
                        <label class="tooltip">Ammunition
                            <span class="tooltiptext">Track ammunition for ranged weapons</span>
                        </label>
                        <div class="ammo-checkboxes">
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo1">
                                <label for="ammo1">1</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo2">
                                <label for="ammo2">2</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo3">
                                <label for="ammo3">3</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo4">
                                <label for="ammo4">4</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo5">
                                <label for="ammo5">5</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo6">
                                <label for="ammo6">6</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo7">
                                <label for="ammo7">7</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo8">
                                <label for="ammo8">8</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo9">
                                <label for="ammo9">9</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo10">
                                <label for="ammo10">10</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo11">
                                <label for="ammo11">11</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ammo12">
                                <label for="ammo12">12</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Special Abilities</div>
            <div class="special-abilities">
                <div class="abilities-grid-2col">
                    <div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 1"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 2"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 3"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 4"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 5"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 6"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 7"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 8"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 9"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 10"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 11"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 12"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 13"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 14"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 15"></div>
                    </div>
                    <div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 16"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 17"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 18"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 19"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 20"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 21"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 22"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 23"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 24"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 25"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 26"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 27"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 28"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 29"></div>
                        <div class="ability-line"><input type="text" placeholder="Special ability 30"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Proficiencies/Skills/Languages</div>
            <div class="proficiencies">
                <div class="proficiencies-grid">
                    <div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 1 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 2 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 3 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 4 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 5 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 6 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 7 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 8 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 9 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 10 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 11 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 12 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 13 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 14 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 15 (___/___)"></div>
                    </div>
                    <div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 16 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 17 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 18 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 19 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 20 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 21 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 22 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 23 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 24 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 25 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 26 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 27 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 28 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 29 (___/___)"></div>
                        <div class="proficiency-line"><input type="text" placeholder="Proficiency/Skill 30 (___/___)"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="save-btn">Save Character</button>
            <button id="load-btn">Load Character</button>
            <button id="print-btn">Print Sheet</button>
            <button id="clear-btn">Clear Sheet</button>
        </div>

        <!-- Character Library Section -->
        <div class="character-library">
            <div class="section-title">Character Library</div>
            <div class="library-header">
                <h3>Your Saved Characters</h3>
                <input type="text" id="search-characters" class="search-box" placeholder="Search characters...">
            </div>
            <div id="characters-grid" class="characters-grid">
                <!-- Character cards will be dynamically generated here -->
            </div>
        </div>
    </div>

    <script>
        // Function to format numbers with commas
        function formatNumberWithCommas(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Function to remove commas and convert to number
        function removeCommasAndParse(numberString) {
            return parseInt(numberString.replace(/,/g, '')) || 0;
        }

        // Function to handle input formatting
        function handleNumberFormatting() {
            const numberInputs = document.querySelectorAll('.comma-number');
            
            numberInputs.forEach(input => {
                // Format on blur (when user leaves the field)
                input.addEventListener('blur', function() {
                    const value = removeCommasAndParse(this.value);
                    this.value = formatNumberWithCommas(value);
                });
                
                // Remove commas on focus for easier editing
                input.addEventListener('focus', function() {
                    this.value = removeCommasAndParse(this.value);
                });
                
                // Initial formatting for existing values
                const initialValue = removeCommasAndParse(input.value);
                input.value = formatNumberWithCommas(initialValue);
            });
        }

        // Character Library Functions
        function getAllSavedCharacters() {
            const characters = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('adndCharacter_')) {
                    try {
                        const characterData = JSON.parse(localStorage.getItem(key));
                        characters.push({
                            key: key,
                            data: characterData
                        });
                    } catch (e) {
                        console.error('Error parsing character data for key:', key, e);
                    }
                }
            }
            return characters;
        }

        function displayCharacters(characters) {
            const grid = document.getElementById('characters-grid');
            
            if (characters.length === 0) {
                grid.innerHTML = '<div class="no-characters">No characters saved yet. Create a character and click "Save Character" to add it to your library.</div>';
                return;
            }
            
            grid.innerHTML = '';
            
            characters.forEach(character => {
                const charData = character.data;
                const card = document.createElement('div');
                card.className = 'character-card';
                
                card.innerHTML = `
                    <h3>${charData.family || 'Unnamed Character'}</h3>
                    <div class="details">
                        <p><span>Player:</span> ${charData.playersName || 'Unknown'}</p>
                        <p><span>Age:</span> ${formatNumberWithCommas(charData.age || 0)}</p>
                    </div>
                    <p><span>Race:</span> ${charData.race || 'Unknown'}</p>
                    <p><span>Class:</span> ${charData.class || 'Unknown'}</p>
                    <p><span>Level:</span> ${formatNumberWithCommas(charData.level || 1)}</p>
                    <div class="character-actions">
                        <button class="load-btn" data-key="${character.key}">Load</button>
                        <button class="delete-btn" data-key="${character.key}">Delete</button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            // Add event listeners to load buttons
            document.querySelectorAll('.load-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const key = this.getAttribute('data-key');
                    loadCharacterFromLibrary(key);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const key = this.getAttribute('data-key');
                    deleteCharacterFromLibrary(key);
                });
            });
        }

        function loadCharacterFromLibrary(key) {
            const characterData = JSON.parse(localStorage.getItem(key));
            
            if (!characterData) {
                alert('Character not found!');
                return;
            }
            
            // Character Information
            document.getElementById('align').value = characterData.align || '';
            document.getElementById('race').value = characterData.race || '';
            document.getElementById('class').value = characterData.class || '';
            document.getElementById('level').value = formatNumberWithCommas(characterData.level || 1);
            document.getElementById('players-name').value = characterData.playersName || '';
            document.getElementById('family').value = characterData.family || '';
            document.getElementById('homland').value = characterData.homland || '';
            document.getElementById('leige-patron').value = characterData.leigePatron || '';
            document.getElementById('religion').value = characterData.religion || '';
            document.getElementById('sex').value = characterData.sex || '';
            document.getElementById('age').value = formatNumberWithCommas(characterData.age || 20);
            document.getElementById('social-class').value = characterData.socialClass || '';
            document.getElementById('status').value = characterData.status || '';
            document.getElementById('ht').value = characterData.ht || '';
            document.getElementById('wt').value = characterData.wt || '';
            document.getElementById('birth-rank').value = characterData.birthRank || '';
            document.getElementById('siblings').value = formatNumberWithCommas(characterData.siblings || 0);
            document.getElementById('hair').value = characterData.hair || '';
            document.getElementById('eyes').value = characterData.eyes || '';
            document.getElementById('appearance').value = characterData.appearance || '';
            document.getElementById('honor').value = formatNumberWithCommas(characterData.honor || 0);
            document.getElementById('base-honor').value = formatNumberWithCommas(characterData.baseHonor || 0);
            document.getElementById('reaction-adjustment').value = formatNumberWithCommas(characterData.reactionAdjustment || 0);

            // Abilities
            document.getElementById('str').value = formatNumberWithCommas(characterData.str || 10);
            document.getElementById('str-hit-prob').value = formatNumberWithCommas(characterData.strHitProb || 0);
            document.getElementById('str-dmg-adj').value = formatNumberWithCommas(characterData.strDmgAdj || 0);
            document.getElementById('str-max-press').value = formatNumberWithCommas(characterData.strMaxPress || 0);
            document.getElementById('str-op-drs').value = formatNumberWithCommas(characterData.strOpDrs || 0);
            document.getElementById('str-bb-lg').value = formatNumberWithCommas(characterData.strBbLg || 0);

            document.getElementById('dex').value = formatNumberWithCommas(characterData.dex || 10);
            document.getElementById('dex-rctn-adj').value = formatNumberWithCommas(characterData.dexRctnAdj || 0);
            document.getElementById('dex-missile-adj').value = formatNumberWithCommas(characterData.dexMissileAdj || 0);
            document.getElementById('dex-def-adj').value = formatNumberWithCommas(characterData.dexDefAdj || 0);

            document.getElementById('con').value = formatNumberWithCommas(characterData.con || 10);
            document.getElementById('con-hp-adj').value = formatNumberWithCommas(characterData.conHpAdj || 0);
            document.getElementById('con-says-shk').value = formatNumberWithCommas(characterData.conSaysShk || 0);
            document.getElementById('con-res-sur').value = formatNumberWithCommas(characterData.conResSur || 0);
            document.getElementById('con-poison-save').value = formatNumberWithCommas(characterData.conPoisonSave || 0);
            document.getElementById('con-regen').value = formatNumberWithCommas(characterData.conRegen || 0);

            document.getElementById('int').value = formatNumberWithCommas(characterData.int || 10);
            document.getElementById('int-lang').value = formatNumberWithCommas(characterData.intLang || 0);
            document.getElementById('int-spell-lvl').value = formatNumberWithCommas(characterData.intSpellLvl || 0);
            document.getElementById('int-lrn-sp').value = formatNumberWithCommas(characterData.intLrnSp || 0);
            document.getElementById('int-spells-level').value = formatNumberWithCommas(characterData.intSpellsLevel || 0);
            document.getElementById('int-spell-immune').value = characterData.intSpellImmune || '';

            document.getElementById('wis').value = formatNumberWithCommas(characterData.wis || 10);
            document.getElementById('wis-mag-def').value = formatNumberWithCommas(characterData.wisMagDef || 0);
            document.getElementById('wis-bonus-spells').value = formatNumberWithCommas(characterData.wisBonusSpells || 0);
            document.getElementById('wis-spell-fail').value = formatNumberWithCommas(characterData.wisSpellFail || 0);
            document.getElementById('wis-spell-immune').value = characterData.wisSpellImmune || '';

            document.getElementById('chr').value = formatNumberWithCommas(characterData.chr || 10);
            document.getElementById('chr-max-hench').value = formatNumberWithCommas(characterData.chrMaxHench || 0);
            document.getElementById('chr-loy-base').value = formatNumberWithCommas(characterData.chrLoyBase || 0);
            document.getElementById('chr-rctn-adj').value = formatNumberWithCommas(characterData.chrRctnAdj || 0);

            // Armor
            document.getElementById('ac').value = formatNumberWithCommas(characterData.ac || 10);
            document.getElementById('surprised-ac').value = formatNumberWithCommas(characterData.surprisedAc || 10);
            document.getElementById('shieldless-ac').value = formatNumberWithCommas(characterData.shieldlessAc || 10);
            document.getElementById('rear-ac').value = formatNumberWithCommas(characterData.rearAc || 10);
            document.getElementById('armor-type').value = characterData.armorType || '';
            document.getElementById('defenses').value = characterData.defenses || '';

            // Hit Points and Movement
            document.getElementById('hit-points').value = formatNumberWithCommas(characterData.hitPoints || 0);
            document.getElementById('wounds').value = characterData.wounds || '';
            document.getElementById('base-rate').value = formatNumberWithCommas(characterData.baseRate || 12);
            document.getElementById('light-move').value = formatNumberWithCommas(characterData.lightMove || 12);
            document.getElementById('mod-move').value = formatNumberWithCommas(characterData.modMove || 9);
            document.getElementById('hvy-move').value = formatNumberWithCommas(characterData.hvyMove || 6);
            document.getElementById('svr-move').value = formatNumberWithCommas(characterData.svrMove || 3);
            document.getElementById('jog-move').value = formatNumberWithCommas(characterData.jogMove || 24);
            document.getElementById('run3-move').value = formatNumberWithCommas(characterData.run3Move || 36);
            document.getElementById('run4-move').value = formatNumberWithCommas(characterData.run4Move || 48);
            document.getElementById('run5-move').value = formatNumberWithCommas(characterData.run5Move || 60);

            // Saving Throws
            document.getElementById('save-paralyze-mod').value = formatNumberWithCommas(characterData.saveParalyzeMod || 0);
            document.getElementById('save-paralyze').value = formatNumberWithCommas(characterData.saveParalyze || 0);
            document.getElementById('save-rod-mod').value = formatNumberWithCommas(characterData.saveRodMod || 0);
            document.getElementById('save-rod').value = formatNumberWithCommas(characterData.saveRod || 0);
            document.getElementById('save-petrify-mod').value = formatNumberWithCommas(characterData.savePetrifyMod || 0);
            document.getElementById('save-petrify').value = formatNumberWithCommas(characterData.savePetrify || 0);
            document.getElementById('save-breath-mod').value = formatNumberWithCommas(characterData.saveBreathMod || 0);
            document.getElementById('save-breath').value = formatNumberWithCommas(characterData.saveBreath || 0);
            document.getElementById('save-spell-mod').value = formatNumberWithCommas(characterData.saveSpellMod || 0);
            document.getElementById('save-spell').value = formatNumberWithCommas(characterData.saveSpell || 0);

            // Weapons and Special Attacks
            document.getElementById('special-attacks').value = characterData.specialAttacks || '';

            // Scroll to top of the sheet
            window.scrollTo(0, 0);
            
            alert('Character loaded successfully!');
        }

        function deleteCharacterFromLibrary(key) {
            if (confirm('Are you sure you want to delete this character? This action cannot be undone.')) {
                localStorage.removeItem(key);
                refreshCharacterLibrary();
                alert('Character deleted successfully!');
            }
        }

        function refreshCharacterLibrary() {
            const characters = getAllSavedCharacters();
            displayCharacters(characters);
        }

        function searchCharacters() {
            const searchTerm = document.getElementById('search-characters').value.toLowerCase();
            const allCharacters = getAllSavedCharacters();
            
            if (!searchTerm) {
                displayCharacters(allCharacters);
                return;
            }
            
            const filteredCharacters = allCharacters.filter(character => {
                const charData = character.data;
                return (
                    (charData.family && charData.family.toLowerCase().includes(searchTerm)) ||
                    (charData.playersName && charData.playersName.toLowerCase().includes(searchTerm)) ||
                    (charData.race && charData.race.toLowerCase().includes(searchTerm)) ||
                    (charData.class && charData.class.toLowerCase().includes(searchTerm))
                );
            });
            
            displayCharacters(filteredCharacters);
        }

        // Initialize number formatting
        document.addEventListener('DOMContentLoaded', function() {
            handleNumberFormatting();
            refreshCharacterLibrary();
            
            // Search functionality
            document.getElementById('search-characters').addEventListener('input', searchCharacters);
            
            // Save character function
            document.getElementById('save-btn').addEventListener('click', function() {
                const characterName = document.getElementById('family').value || 'Unnamed Character';
                const playerName = document.getElementById('players-name').value || 'Unknown Player';
                const characterKey = `adndCharacter_${characterName}_${playerName}_${Date.now()}`;
                
                const characterData = {
                    // Character Information
                    align: document.getElementById('align').value,
                    race: document.getElementById('race').value,
                    class: document.getElementById('class').value,
                    level: removeCommasAndParse(document.getElementById('level').value),
                    playersName: document.getElementById('players-name').value,
                    family: document.getElementById('family').value,
                    homland: document.getElementById('homland').value,
                    leigePatron: document.getElementById('leige-patron').value,
                    religion: document.getElementById('religion').value,
                    sex: document.getElementById('sex').value,
                    age: removeCommasAndParse(document.getElementById('age').value),
                    socialClass: document.getElementById('social-class').value,
                    status: document.getElementById('status').value,
                    ht: document.getElementById('ht').value,
                    wt: document.getElementById('wt').value,
                    birthRank: document.getElementById('birth-rank').value,
                    siblings: removeCommasAndParse(document.getElementById('siblings').value),
                    hair: document.getElementById('hair').value,
                    eyes: document.getElementById('eyes').value,
                    appearance: document.getElementById('appearance').value,
                    honor: removeCommasAndParse(document.getElementById('honor').value),
                    baseHonor: removeCommasAndParse(document.getElementById('base-honor').value),
                    reactionAdjustment: removeCommasAndParse(document.getElementById('reaction-adjustment').value),

                    // Abilities
                    str: removeCommasAndParse(document.getElementById('str').value),
                    strHitProb: removeCommasAndParse(document.getElementById('str-hit-prob').value),
                    strDmgAdj: removeCommasAndParse(document.getElementById('str-dmg-adj').value),
                    strMaxPress: removeCommasAndParse(document.getElementById('str-max-press').value),
                    strOpDrs: removeCommasAndParse(document.getElementById('str-op-drs').value),
                    strBbLg: removeCommasAndParse(document.getElementById('str-bb-lg').value),

                    dex: removeCommasAndParse(document.getElementById('dex').value),
                    dexRctnAdj: removeCommasAndParse(document.getElementById('dex-rctn-adj').value),
                    dexMissileAdj: removeCommasAndParse(document.getElementById('dex-missile-adj').value),
                    dexDefAdj: removeCommasAndParse(document.getElementById('dex-def-adj').value),

                    con: removeCommasAndParse(document.getElementById('con').value),
                    conHpAdj: removeCommasAndParse(document.getElementById('con-hp-adj').value),
                    conSaysShk: removeCommasAndParse(document.getElementById('con-says-shk').value),
                    conResSur: removeCommasAndParse(document.getElementById('con-res-sur').value),
                    conPoisonSave: removeCommasAndParse(document.getElementById('con-poison-save').value),
                    conRegen: removeCommasAndParse(document.getElementById('con-regen').value),

                    int: removeCommasAndParse(document.getElementById('int').value),
                    intLang: removeCommasAndParse(document.getElementById('int-lang').value),
                    intSpellLvl: removeCommasAndParse(document.getElementById('int-spell-lvl').value),
                    intLrnSp: removeCommasAndParse(document.getElementById('int-lrn-sp').value),
                    intSpellsLevel: removeCommasAndParse(document.getElementById('int-spells-level').value),
                    intSpellImmune: document.getElementById('int-spell-immune').value,

                    wis: removeCommasAndParse(document.getElementById('wis').value),
                    wisMagDef: removeCommasAndParse(document.getElementById('wis-mag-def').value),
                    wisBonusSpells: removeCommasAndParse(document.getElementById('wis-bonus-spells').value),
                    wisSpellFail: removeCommasAndParse(document.getElementById('wis-spell-fail').value),
                    wisSpellImmune: document.getElementById('wis-spell-immune').value,

                    chr: removeCommasAndParse(document.getElementById('chr').value),
                    chrMaxHench: removeCommasAndParse(document.getElementById('chr-max-hench').value),
                    chrLoyBase: removeCommasAndParse(document.getElementById('chr-loy-base').value),
                    chrRctnAdj: removeCommasAndParse(document.getElementById('chr-rctn-adj').value),

                    // Armor
                    ac: removeCommasAndParse(document.getElementById('ac').value),
                    surprisedAc: removeCommasAndParse(document.getElementById('surprised-ac').value),
                    shieldlessAc: removeCommasAndParse(document.getElementById('shieldless-ac').value),
                    rearAc: removeCommasAndParse(document.getElementById('rear-ac').value),
                    armorType: document.getElementById('armor-type').value,
                    defenses: document.getElementById('defenses').value,

                    // Hit Points and Movement
                    hitPoints: removeCommasAndParse(document.getElementById('hit-points').value),
                    wounds: document.getElementById('wounds').value,
                    baseRate: removeCommasAndParse(document.getElementById('base-rate').value),
                    lightMove: removeCommasAndParse(document.getElementById('light-move').value),
                    modMove: removeCommasAndParse(document.getElementById('mod-move').value),
                    hvyMove: removeCommasAndParse(document.getElementById('hvy-move').value),
                    svrMove: removeCommasAndParse(document.getElementById('svr-move').value),
                    jogMove: removeCommasAndParse(document.getElementById('jog-move').value),
                    run3Move: removeCommasAndParse(document.getElementById('run3-move').value),
                    run4Move: removeCommasAndParse(document.getElementById('run4-move').value),
                    run5Move: removeCommasAndParse(document.getElementById('run5-move').value),

                    // Saving Throws
                    saveParalyzeMod: removeCommasAndParse(document.getElementById('save-paralyze-mod').value),
                    saveParalyze: removeCommasAndParse(document.getElementById('save-paralyze').value),
                    saveRodMod: removeCommasAndParse(document.getElementById('save-rod-mod').value),
                    saveRod: removeCommasAndParse(document.getElementById('save-rod').value),
                    savePetrifyMod: removeCommasAndParse(document.getElementById('save-petrify-mod').value),
                    savePetrify: removeCommasAndParse(document.getElementById('save-petrify').value),
                    saveBreathMod: removeCommasAndParse(document.getElementById('save-breath-mod').value),
                    saveBreath: removeCommasAndParse(document.getElementById('save-breath').value),
                    saveSpellMod: removeCommasAndParse(document.getElementById('save-spell-mod').value),
                    saveSpell: removeCommasAndParse(document.getElementById('save-spell').value),

                    // Weapons
                    specialAttacks: document.getElementById('special-attacks').value
                };

                // Save to localStorage
                localStorage.setItem(characterKey, JSON.stringify(characterData));
                alert('Character saved successfully!');
                
                // Refresh the character library
                refreshCharacterLibrary();
            });

            // Load character function (legacy - for backward compatibility)
            document.getElementById('load-btn').addEventListener('click', function() {
                const savedCharacter = localStorage.getItem('adndCharacterCustom');
                if (savedCharacter) {
                    const characterData = JSON.parse(savedCharacter);

                    // Character Information
                    document.getElementById('align').value = characterData.align || '';
                    document.getElementById('race').value = characterData.race || '';
                    document.getElementById('class').value = characterData.class || '';
                    document.getElementById('level').value = formatNumberWithCommas(characterData.level || 1);
                    document.getElementById('players-name').value = characterData.playersName || '';
                    document.getElementById('family').value = characterData.family || '';
                    document.getElementById('homland').value = characterData.homland || '';
                    document.getElementById('leige-patron').value = characterData.leigePatron || '';
                    document.getElementById('religion').value = characterData.religion || '';
                    document.getElementById('sex').value = characterData.sex || '';
                    document.getElementById('age').value = formatNumberWithCommas(characterData.age || 20);
                    document.getElementById('social-class').value = characterData.socialClass || '';
                    document.getElementById('status').value = characterData.status || '';
                    document.getElementById('ht').value = characterData.ht || '';
                    document.getElementById('wt').value = characterData.wt || '';
                    document.getElementById('birth-rank').value = characterData.birthRank || '';
                    document.getElementById('siblings').value = formatNumberWithCommas(characterData.siblings || 0);
                    document.getElementById('hair').value = characterData.hair || '';
                    document.getElementById('eyes').value = characterData.eyes || '';
                    document.getElementById('appearance').value = characterData.appearance || '';
                    document.getElementById('honor').value = formatNumberWithCommas(characterData.honor || 0);
                    document.getElementById('base-honor').value = formatNumberWithCommas(characterData.baseHonor || 0);
                    document.getElementById('reaction-adjustment').value = formatNumberWithCommas(characterData.reactionAdjustment || 0);

                    // Abilities
                    document.getElementById('str').value = formatNumberWithCommas(characterData.str || 10);
                    document.getElementById('str-hit-prob').value = formatNumberWithCommas(characterData.strHitProb || 0);
                    document.getElementById('str-dmg-adj').value = formatNumberWithCommas(characterData.strDmgAdj || 0);
                    document.getElementById('str-max-press').value = formatNumberWithCommas(characterData.strMaxPress || 0);
                    document.getElementById('str-op-drs').value = formatNumberWithCommas(characterData.strOpDrs || 0);
                    document.getElementById('str-bb-lg').value = formatNumberWithCommas(characterData.strBbLg || 0);

                    document.getElementById('dex').value = formatNumberWithCommas(characterData.dex || 10);
                    document.getElementById('dex-rctn-adj').value = formatNumberWithCommas(characterData.dexRctnAdj || 0);
                    document.getElementById('dex-missile-adj').value = formatNumberWithCommas(characterData.dexMissileAdj || 0);
                    document.getElementById('dex-def-adj').value = formatNumberWithCommas(characterData.dexDefAdj || 0);

                    document.getElementById('con').value = formatNumberWithCommas(characterData.con || 10);
                    document.getElementById('con-hp-adj').value = formatNumberWithCommas(characterData.conHpAdj || 0);
                    document.getElementById('con-says-shk').value = formatNumberWithCommas(characterData.conSaysShk || 0);
                    document.getElementById('con-res-sur').value = formatNumberWithCommas(characterData.conResSur || 0);
                    document.getElementById('con-poison-save').value = formatNumberWithCommas(characterData.conPoisonSave || 0);
                    document.getElementById('con-regen').value = formatNumberWithCommas(characterData.conRegen || 0);

                    document.getElementById('int').value = formatNumberWithCommas(characterData.int || 10);
                    document.getElementById('int-lang').value = formatNumberWithCommas(characterData.intLang || 0);
                    document.getElementById('int-spell-lvl').value = formatNumberWithCommas(characterData.intSpellLvl || 0);
                    document.getElementById('int-lrn-sp').value = formatNumberWithCommas(characterData.intLrnSp || 0);
                    document.getElementById('int-spells-level').value = formatNumberWithCommas(characterData.intSpellsLevel || 0);
                    document.getElementById('int-spell-immune').value = characterData.intSpellImmune || '';

                    document.getElementById('wis').value = formatNumberWithCommas(characterData.wis || 10);
                    document.getElementById('wis-mag-def').value = formatNumberWithCommas(characterData.wisMagDef || 0);
                    document.getElementById('wis-bonus-spells').value = formatNumberWithCommas(characterData.wisBonusSpells || 0);
                    document.getElementById('wis-spell-fail').value = formatNumberWithCommas(characterData.wisSpellFail || 0);
                    document.getElementById('wis-spell-immune').value = characterData.wisSpellImmune || '';

                    document.getElementById('chr').value = formatNumberWithCommas(characterData.chr || 10);
                    document.getElementById('chr-max-hench').value = formatNumberWithCommas(characterData.chrMaxHench || 0);
                    document.getElementById('chr-loy-base').value = formatNumberWithCommas(characterData.chrLoyBase || 0);
                    document.getElementById('chr-rctn-adj').value = formatNumberWithCommas(characterData.chrRctnAdj || 0);

                    // Armor
                    document.getElementById('ac').value = formatNumberWithCommas(characterData.ac || 10);
                    document.getElementById('surprised-ac').value = formatNumberWithCommas(characterData.surprisedAc || 10);
                    document.getElementById('shieldless-ac').value = formatNumberWithCommas(characterData.shieldlessAc || 10);
                    document.getElementById('rear-ac').value = formatNumberWithCommas(characterData.rearAc || 10);
                    document.getElementById('armor-type').value = characterData.armorType || '';
                    document.getElementById('defenses').value = characterData.defenses || '';

                    // Hit Points and Movement
                    document.getElementById('hit-points').value = formatNumberWithCommas(characterData.hitPoints || 0);
                    document.getElementById('wounds').value = characterData.wounds || '';
                    document.getElementById('base-rate').value = formatNumberWithCommas(characterData.baseRate || 12);
                    document.getElementById('light-move').value = formatNumberWithCommas(characterData.lightMove || 12);
                    document.getElementById('mod-move').value = formatNumberWithCommas(characterData.modMove || 9);
                    document.getElementById('hvy-move').value = formatNumberWithCommas(characterData.hvyMove || 6);
                    document.getElementById('svr-move').value = formatNumberWithCommas(characterData.svrMove || 3);
                    document.getElementById('jog-move').value = formatNumberWithCommas(characterData.jogMove || 24);
                    document.getElementById('run3-move').value = formatNumberWithCommas(characterData.run3Move || 36);
                    document.getElementById('run4-move').value = formatNumberWithCommas(characterData.run4Move || 48);
                    document.getElementById('run5-move').value = formatNumberWithCommas(characterData.run5Move || 60);

                    // Saving Throws
                    document.getElementById('save-paralyze-mod').value = formatNumberWithCommas(characterData.saveParalyzeMod || 0);
                    document.getElementById('save-paralyze').value = formatNumberWithCommas(characterData.saveParalyze || 0);
                    document.getElementById('save-rod-mod').value = formatNumberWithCommas(characterData.saveRodMod || 0);
                    document.getElementById('save-rod').value = formatNumberWithCommas(characterData.saveRod || 0);
                    document.getElementById('save-petrify-mod').value = formatNumberWithCommas(characterData.savePetrifyMod || 0);
                    document.getElementById('save-petrify').value = formatNumberWithCommas(characterData.savePetrify || 0);
                    document.getElementById('save-breath-mod').value = formatNumberWithCommas(characterData.saveBreathMod || 0);
                    document.getElementById('save-breath').value = formatNumberWithCommas(characterData.saveBreath || 0);
                    document.getElementById('save-spell-mod').value = formatNumberWithCommas(characterData.saveSpellMod || 0);
                    document.getElementById('save-spell').value = formatNumberWithCommas(characterData.saveSpell || 0);

                    // Weapons and Special Attacks
                    document.getElementById('special-attacks').value = characterData.specialAttacks || '';

                    alert('Character loaded successfully!');
                } else {
                    alert('No saved character found!');
                }
            });

            // Print function
            document.getElementById('print-btn').addEventListener('click', function() {
                window.print();
            });

            // Clear sheet function
            document.getElementById('clear-btn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the entire character sheet?')) {
                    // Clear all inputs
                    const inputs = document.querySelectorAll('input, textarea, select');
                    inputs.forEach(input => {
                        if (input.classList.contains('comma-number')) {
                            input.value = input.id === 'level' ? '1' :
                                input.id === 'age' ? '20' :
                                input.id === 'str' || input.id === 'dex' ||
                                input.id === 'con' || input.id === 'int' ||
                                input.id === 'wis' || input.id === 'chr' ? '10' :
                                input.id === 'ac' || input.id === 'surprised-ac' ||
                                input.id === 'shieldless-ac' || input.id === 'rear-ac' ? '10' :
                                input.id === 'base-rate' || input.id === 'light-move' ? '12' :
                                input.id === 'mod-move' ? '9' :
                                input.id === 'hvy-move' ? '6' :
                                input.id === 'svr-move' ? '3' :
                                input.id === 'jog-move' ? '24' :
                                input.id === 'run3-move' ? '36' :
                                input.id === 'run4-move' ? '48' :
                                input.id === 'run5-move' ? '60' : '0';
                        } else if (input.type === 'text' || input.tagName === 'TEXTAREA') {
                            input.value = '';
                        } else if (input.type === 'checkbox') {
                            input.checked = false;
                        }
                    });
                    
                    // Reapply formatting
                    handleNumberFormatting();
                }
            });
        });
    </script>
</body>

</html>
